!function(){let e=document.querySelector.bind(document),t=document.querySelectorAll.bind(document),n=document.getElementById.bind(document),s;var a,o,i,r,c={cityLat:0,cityLon:0,cityName:"",countryShort:"",tempMode:"celsius",windMode:"kmh",windSpeed:0,darkMode:!1};let d={bgImg:e(".js_bg_img"),locationCity:e(".js_location"),locationCountry:e(".js_country"),video:e(".js_video"),videoSource:e(".js_video_source"),date:e(".js_date"),temp:e(".js_temp"),description:e(".js_description"),tempMinMax:e(".js_temp_min_max .value"),chanceOfRain:e(".js_chance_of_rain .js_value"),uvIndex:e(".js_uv_index .js_value"),wind:e(".js_wind .js_value"),sunriseSunset:e(".js_sunrise_sunset .js_value"),icon:e(".js_weather_icon"),forecastList:e(".js_forecast_list"),currentWeather:e(".js_current_weather"),setDayTodayBtn:e(".js_set_date_today"),airquality:e(".js_air_quality .js_value"),settingsWindow:e(".js_settings"),settingsBlurBg:e(".js_blur_bg"),settingsOpen:e(".js_settings_trigger"),settingsClose:e(".js_settings .js_close"),settingsLocation:n("locationSearch"),settingsTempBool:n("settingTempMode"),settingsWindBool:n("settingWindSpeed"),settingsDarkmodeBool:n("settingDarkMode")};function u(e,t,n,a,o){var i,r=e,c=t,u=n;(function e(t,n,s,a){fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${t}&longitude=${n}&localityLanguage=en`).then(e=>e.json()).then(e=>{s?d.locationCity.textContent=s:(d.locationCity.textContent=e.city,chrome.storage.sync.set({cityName:e.city})),a?(d.locationCountry.textContent=a,chrome.storage.sync.set({countryShort:a})):(d.locationCountry.textContent=e.countryCode,chrome.storage.sync.set({countryShort:e.countryCode})),s?chrome.storage.sync.set({cityName:s}):chrome.storage.sync.set({cityName:e[0].name}),countryShort?chrome.storage.sync.set({countryShort:countryShort}):chrome.storage.sync.set({countryShort:e[0].country}),chrome.storage.sync.set({userLocation:{lat:userPosLat,long:userPosLong}})}).catch(function(e){})})(c,u,a,o),i=`https://api.open-meteo.com/v1/forecast?latitude=${c}&longitude=${u}&hourly=temperature_2m,precipitation&daily=weathercode,temperature_2m_max,temperature_2m_min,sunrise,sunset,precipitation_sum,windspeed_10m_max&current_weather=true&temperature_unit=${r}&timezone=auto`,chrome.storage.sync.get("weatherDataFetchedTimestamp",function(t){void 0!==t.weatherDataFetchedTimestamp?Date.now()-t.weatherDataFetchedTimestamp>864e5?fetch(i).then(e=>e.json()).then(t=>{chrome.storage.sync.set({weatherData:t}),chrome.storage.sync.set({weatherDataFetchedTimestamp:Date.now()}),l(t,0,e),s=t,document.body.dataset.tempMode=r}).catch(function(e){console.log(e)}):chrome.storage.sync.get("weatherData",function(t){l(t.weatherData,0,e),s=t.weatherData,document.body.dataset.tempMode=r}):fetch(i).then(e=>e.json()).then(t=>{chrome.storage.sync.set({weatherData:t}),chrome.storage.sync.set({weatherDataFetchedTimestamp:Date.now()}),l(t,0,e),s=t,document.body.dataset.tempMode=r}).catch(function(e){console.log(e)})})}function l(e,t,n){d.temp.textContent=Math.round(e.current_weather.temperature,2),d.description.textContent=v(e.current_weather.weathercode),d.tempMinMax.textContent=Math.round(e.daily.temperature_2m_max[t],2)+"\xb0 / "+Math.round(e.daily.temperature_2m_min[0],2)+"\xb0",d.chanceOfRain.textContent=Math.round(e.daily.precipitation_sum[t],2)+" mm",d.wind.textContent=g(e.daily.windspeed_10m_max[t]),d.sunriseSunset.textContent=$(e.daily.sunrise[t])+" / "+$(e.daily.sunset[t]),function e(t){let n=`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${c.cityLat}&longitude=${c.cityLon}&hourly=pm10,uv_index`,s=["Good","Fair","Poor","Very poor","Unhealthy"],a,o;fetch(n).then(e=>e.json()).then(e=>{5==t&&(t=4),(a=e.hourly.pm10[new Date().getHours()+24*t])<40?o=s[0]:a>=40&&a<80?o=s[1]:a>=80&&a<120?o=s[2]:a>=120&&a<300?o=s[3]:a>=300&&(o=s[4]),d.airquality.textContent=o,d.uvIndex.textContent=e.hourly.uv_index[new Date().getHours()+24*t]}).catch(()=>{console.log("Air Quality Index temporarily not available. Please try again later."),d.airquality.textContent="N/A"})}(t);var s=""+e.current_weather.weathercode;d.bgImg.src="assets/img/weather/"+s.charAt(0)+".jpg",0===t&&function e(t){var n=t.daily;let s;d.forecastList.innerHTML="";for(var a=0;a<n.sunset.length;a++)if(s=(s=""+n.weathercode[a]).charAt(0),-1===[0,6,7].indexOf(a)){var o=`<li class="day js_day" data-idx="${a}" data-day="${w(n.time[a])}">
						<span class="date_day">${h(n.time[a])}</span>
						<span class="icon_description">
							<img class="day_icon js_day_icon" width="60" src="assets/icons/weather/${s}.svg" />
							<span class="day_description js_day_description">${v(n.weathercode[a])}</span>
						</span>
						<span class="day_min_max">
							<span class="day_max js_day_max">${Math.round(n.temperature_2m_max[a],2)}\xb0</span>
							<span class="day_min js_day_min">${Math.round(n.temperature_2m_min[a],2)}\xb0</span>
						</span>
					</li>`;d.forecastList.appendChild(y(o,a,h(n.time[a])))}}(e)}function g(e){c.windSpeed=e;var t=c.windMode;return"kmh"==t?Math.round(c.windSpeed,2)+" km/h":"mph"==t?Math.round(c.windSpeed/1.609,2)+" mph":void 0}function y(n,a,o){var i=document.createElement("template");return i.innerHTML=n,i.content.childNodes[0].addEventListener("click",function(){t(".js_day").forEach(e=>e.classList.remove("active")),this.classList.add("active"),l(s,a),e(".js_today_label").textContent=o,d.setDayTodayBtn.classList.add("active")}),i.content.childNodes[0]}function m(e){var t,n;return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][(t=new Date(1e3*e)).getDay()]}function h(e){var t,n;return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][(t=new Date(e)).getDay()]}function p(e){var t=new Date;return t.getDay(),["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]}function v(e){return({0:"☀️ Clear sky",1:"\uD83C\uDF24 Mainly clear",2:"⛅️ Partly cloudy",3:"☁️ Overcast",45:"\uD83C\uDF2B Fog",46:"\uD83C\uDF2B Depositing rime fog",51:"\uD83C\uDF27 Drizzle",53:"\uD83C\uDF27 Drizzle",55:"\uD83C\uDF27 Drizzle",56:"\uD83C\uDF28 Freezing Drizzle",57:"\uD83C\uDF28 Freezing Drizzle",61:"\uD83C\uDF27 Rain",63:"\uD83C\uDF27 Rain",65:"\uD83C\uDF27 Rain",66:"\uD83C\uDF28 Freezing Rain",67:"\uD83C\uDF28 Freezing Rain",71:"❄️ Snow",73:"❄️ Snow",75:"❄️ Snow",77:"❄️ Snow grains",80:"\uD83C\uDF27 Rain showers",81:"\uD83C\uDF27 Rain showers",82:"\uD83C\uDF27 Rain showers",85:"❄️ Snow showers",86:"❄️ Snow showers",95:"\uD83C\uDF2A Thunderstorm",96:"\uD83C\uDF2A Thunderstorm with hail",99:"\uD83C\uDF2A Thunderstorm with hail"})[e]}function w(e){var t,n;return(t=new Date(e)).getDate()}function $(e){return(hour=(date=new Date(e)).toLocaleTimeString()).slice(0,-3)}chrome.storage.sync.get("cityName",function(e){void 0!==e.cityName?c.cityName=e.cityName:chrome.storage.sync.set({cityName:""})}),chrome.storage.sync.get("countryShort",function(e){void 0!==e.countryShort?c.countryShort=e.countryShort:chrome.storage.sync.set({countryShort:""})}),chrome.storage.sync.get("settingsDarkmode",function(e){if(void 0!==e.settingsDarkmode){d.settingsDarkmodeBool.checked=e.settingsDarkmode;var t=new Event("change");d.settingsDarkmodeBool.dispatchEvent(t)}else chrome.storage.sync.set({settingsDarkmode:!1})}),chrome.storage.sync.get("settingsWindmode",function(e){if(void 0!==e.settingsWindmode){d.settingsWindBool.checked="kmh"===e.settingsWindmode;var t=new Event("change");d.settingsWindBool.dispatchEvent(t)}else chrome.storage.sync.set({settingsWindmode:"kmh"})}),chrome.storage.sync.get("settingsTempmode",function(e){if(void 0!==e.settingsTempmode){d.settingsTempBool.checked="celsius"===e.settingsTempmode;var t=new Event("change");d.settingsWindBool.dispatchEvent(t)}else chrome.storage.sync.set({settingsTempmode:"celsius"})}),chrome.storage.sync.get("userLocation",function(e){void 0!==e.userLocation&&(c.cityLat=e.userLocation.lat,c.cityLon=e.userLocation.long)}),o=(a=new Date).getDay(),i=a.getDate()+", "+["January","February","March","April","May","June","July","August","September","October","November","December"][a.getMonth()]+" "+a.getFullYear(),d.date.textContent=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"][o-1]+" "+i,function e(){var t={enableHighAccuracy:!0,timeout:5e3,maximumAge:0};function n(e){var t=e.coords;chrome.storage.sync.set({userLocation:{lat:t.latitude,long:t.longitude}}),u(c.tempMode,t.latitude,t.longitude)}function s(e){console.warn(`ERROR(${e.code}): ${e.message}`)}chrome.storage.sync.get("userLocation",function(e){void 0!==e.userLocation?u(c.tempMode,e.userLocation.lat,e.userLocation.long,c.cityName,c.countryShort):navigator.geolocation.getCurrentPosition(n,s,t)})}(),d.setDayTodayBtn.addEventListener("click",function(){this.classList.remove("active"),t(".js_day").forEach(e=>e.classList.remove("active")),e(".js_today_label").textContent="Today",l(s,0,1)}),d.settingsClose.addEventListener("click",function(){d.settingsWindow.classList.remove("active"),d.settingsBlurBg.classList.remove("active")}),d.settingsBlurBg.addEventListener("click",function(){d.settingsWindow.classList.remove("active"),this.classList.remove("active")}),d.settingsOpen.addEventListener("click",function(){d.settingsWindow.classList.add("active"),d.settingsBlurBg.classList.add("active")}),d.settingsLocation.addEventListener("keyup",function(){var e=this.value,t=this.value.length;r=`https://geocoding-api.open-meteo.com/v1/search?name=${this.value}&count=5`,t>1&&fetch(r).then(e=>e.json()).then(t=>{autocomplete(d.settingsLocation,t.results,e)}).catch(()=>{console.log("error")})}),d.settingsLocation.addEventListener("change",function(){var e=this;window.setTimeout(function(){chrome.storage.sync.set({weatherDataFetchedTimestamp:0}),c.cityLat=e.dataset.lat,c.cityLon=e.dataset.lon,u(c.tempMode,e.dataset.lat,e.dataset.lon,e.dataset.city,e.dataset.countryCode)},300)}),d.settingsTempBool.addEventListener("change",function(){var e=this.checked;this.checked?c.tempMode="celsius":c.tempMode="fahrenheit",u(c.tempMode,c.cityLat,c.cityLon),chrome.storage.sync.set({settingsTempmode:e?"celsius":"fahrenheit"})}),d.settingsWindBool.addEventListener("change",function(){this.checked?c.windMode="kmh":c.windMode="mph",chrome.storage.sync.set({settingsWindmode:c.windMode}),d.wind.textContent=g(c.windSpeed)}),d.settingsDarkmodeBool.addEventListener("change",function(){this.checked?document.body.classList.add("darkmode"):document.body.classList.remove("darkmode"),chrome.storage.sync.set({settingsDarkmode:this.checked})})}();